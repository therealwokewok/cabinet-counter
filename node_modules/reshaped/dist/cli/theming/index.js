import fs from "fs";
import path from "path";
import chalk from "chalk";
import mergeDefinitions from "../../themes/_generator/utilities/mergeDefinitions.js";
import transform from "../../themes/_generator/transform.js";
import reshapedDefinition from "../../themes/_generator/definitions/reshaped.js";
import { transformToTailwind } from "./tailwind.js";
const transformDefinition = (name, definition, options) => {
    const { isFragment, outputPath } = options;
    const code = transform(name, definition, options);
    const themeFolderPath = isFragment
        ? path.resolve(outputPath, "fragments", name)
        : path.resolve(outputPath, name);
    const themePath = path.resolve(themeFolderPath, "theme.css");
    const themeMediaPath = path.resolve(themeFolderPath, "media.css");
    const twPath = path.resolve(themeFolderPath, "tailwind.css");
    const themeJsonPath = path.resolve(themeFolderPath, "theme.json");
    fs.mkdirSync(themeFolderPath, { recursive: true });
    fs.writeFileSync(themePath, code.variables);
    fs.writeFileSync(themeJsonPath, JSON.stringify(code.theme, null, 2));
    fs.writeFileSync(twPath, transformToTailwind(code.theme));
    if (code.media)
        fs.writeFileSync(themeMediaPath, code.media);
    const logOutput = `Compiled ${chalk.bold(name)} theme${isFragment ? " fragment" : ""}`;
    console.log(chalk.green(logOutput));
};
export const addThemeFragment = (name, definition, options) => {
    transformDefinition(name, definition, { ...options, isFragment: true });
};
export const addTheme = (name, definition, options) => {
    transformDefinition(name, mergeDefinitions(reshapedDefinition, definition), options);
};
