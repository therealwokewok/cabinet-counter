"use client";
import { jsx as _jsx } from "react/jsx-runtime";
import { forwardRef, useState } from "react";
import { classNames } from "../../utilities/props.js";
import Button from "../Button/index.js";
import IconChevronRight from "../../icons/ChevronRight.js";
import IconChevronLeft from "../../icons/ChevronLeft.js";
import useIsomorphicLayoutEffect from "../../hooks/useIsomorphicLayoutEffect.js";
import s from "./Carousel.module.css";
const CarouselControl = forwardRef((props, ref) => {
    const { type, scrollElRef, oppositeControlElRef, scrollPosition, onClick, isRTL, mounted } = props;
    const [visible, setVisible] = useState(false);
    const [rendered, setRendered] = useState(false);
    const isNext = type === "forward";
    const isDisplayedAsNext = type === (isRTL ? "back" : "forward");
    const controlClassNames = classNames(s.control, isDisplayedAsNext ? s["--control-next"] : s["--control-prev"], visible && s["--control-visible"], rendered && s["--control-rendered"]);
    useIsomorphicLayoutEffect(() => {
        const scrollEl = scrollElRef.current;
        if (!scrollEl || !mounted)
            return;
        let timer;
        const normalizedScrollPosition = Math.abs(scrollPosition);
        const isScrollAtStart = normalizedScrollPosition <= 0;
        const isScrollAtEnd = normalizedScrollPosition + scrollEl.clientWidth >= scrollEl.scrollWidth - 1;
        const hideControl = isNext ? isScrollAtEnd : isScrollAtStart;
        if (hideControl) {
            setVisible(false);
            timer = setTimeout(() => setRendered(false), 1500);
            oppositeControlElRef.current?.focus();
        }
        else {
            setRendered(true);
            setVisible(true);
        }
        return () => {
            if (timer)
                clearTimeout(timer);
        };
    }, [scrollPosition, scrollElRef, mounted, isNext]);
    return (_jsx("div", { className: controlClassNames, children: _jsx(Button, { size: "small", onClick: onClick, icon: isDisplayedAsNext ? IconChevronRight : IconChevronLeft, rounded: true, variant: "outline", elevated: true, attributes: { "aria-disabled": !visible, "aria-hidden": true }, ref: ref }) }));
});
CarouselControl.displayName = "CarouselControl";
export default CarouselControl;
