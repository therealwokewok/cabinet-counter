"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { classNames } from "../../utilities/props.js";
import View from "../View/index.js";
import HiddenVisually from "../HiddenVisually/index.js";
import useToggle from "../../hooks/useToggle.js";
import s from "./FileUpload.module.css";
export const FileUploadTrigger = (props) => {
    const { children } = props;
    return _jsx("span", { className: s.trigger, children: children });
};
const FileUpload = (props) => {
    const { name, children, height, variant = "outline", inline, className, attributes, inputAttributes, onChange, } = props;
    const highlightToggle = useToggle();
    const rootClassNames = classNames(s.root, variant && s[`--variant-${variant}`], inline && s[`--inline`], highlightToggle.active && s["--highlighted"], className);
    const handleDragOver = (event) => {
        event.preventDefault();
        attributes?.onDragOver?.(event);
    };
    const handleDragEnter = (event) => {
        highlightToggle.activate();
        attributes?.onDragEnter?.(event);
    };
    const handleDragLeave = (event) => {
        // Ignore elements inside the field
        if (event.currentTarget.contains(event.relatedTarget))
            return;
        highlightToggle.deactivate();
        attributes?.onDragLeave?.(event);
    };
    const handleDrop = (event) => {
        event.preventDefault();
        highlightToggle.deactivate();
        onChange?.({ name, value: Array.from(event.dataTransfer.files), event });
        attributes?.onDrop?.(event);
    };
    const handleChange = (event) => {
        const nextValue = event.target.files;
        if (!nextValue)
            return;
        onChange?.({ name, event, value: Array.from(nextValue) });
        inputAttributes?.onChange?.(event);
    };
    const inputNode = (_jsx(HiddenVisually, { children: _jsx("input", { ...inputAttributes, type: "file", className: s.field, name: name, onChange: handleChange }) }));
    const childrenNode = typeof children === "function" ? children({ highlighted: highlightToggle.active }) : children;
    return (_jsx(View, { className: rootClassNames, height: height, attributes: {
            ...attributes,
            onDragOver: handleDragOver,
            onDragEnter: handleDragEnter,
            onDragLeave: handleDragLeave,
            onDrop: handleDrop,
        }, children: variant === "outline" && !inline ? (_jsxs(View, { as: "label", className: s.triggerLayer, padding: 6, borderRadius: "medium", gap: 2, align: "center", justify: "center", textAlign: "center", animated: true, height: "100%", children: [inputNode, _jsx(View.Item, { children: childrenNode })] })) : (_jsxs("label", { className: s.triggerLayer, children: [inputNode, childrenNode] })) }));
};
FileUpload.displayName = "FileUpload";
FileUploadTrigger.displayName = "FileUpload.Trigger";
export default FileUpload;
